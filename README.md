

# HAPService - AI-Powered Image Search Engine for Human Protein Atlas

## Overview

HAPService is an AI-powered image search engine designed for the Human Protein Atlas (HPA). This service allows users to search for predictions based on image data and update image paths in the system. The API is built on gRPC protocol using the `proto3` syntax, ensuring efficient and reliable communication between the client and server.

## Features

- **Search for Predictions:** Provide an image path, and the service returns predictions from an AI model.
- **Update Image Paths:** Modify the image path within the system and receive a status update on the success of the operation.

## API Schema

### Service: `HAPService`

#### 1. **Search**

This RPC takes an image path and returns a prediction based on the image.

- **Endpoint**: `/Search`
- **Request**: `SearchImagePath`
- **Response**: `PredictionResponse`

##### Request (`SearchImagePath`):

| Field        | Type   | Description                      |
|--------------|--------|----------------------------------|
| `image_path` | string | Path to the image for prediction |

##### Response (`PredictionResponse`):

| Field        | Type   | Description                             |
|--------------|--------|-----------------------------------------|
| `prediction` | string | The prediction generated by the model   |

##### Example:
```json
{
  "image_path": "/path/to/image/file"
}
```
```json
{
  "prediction": "Similar to segment 2"
}
```

#### 2. **Update**

This RPC takes an image path and updates it in the system. It returns the status of the update operation.

- **Endpoint**: `/Update`
- **Request**: `UpdateImagePath`
- **Response**: `UpdateStatus`

##### Request (`UpdateImagePath`):

| Field        | Type   | Description                      |
|--------------|--------|----------------------------------|
| `image_path` | string | Path to the image to be updated  |

##### Response (`UpdateStatus`):

| Field        | Type  | Description                         |
|--------------|-------|-------------------------------------|
| `status`     | bool  | `true` if update was successful, otherwise `false` |

##### Example:
```json
{
  "image_path": "/new/path/to/image/file"
}
```
```json
{
  "status": true
}
```

### Messages Summary

- **SearchImagePath**: Contains the image path for searching.
- **UpdateImagePath**: Contains the image path for updating.
- **PredictionResponse**: Returns a single prediction as a string.
- **UpdateStatus**: Returns a boolean indicating whether the update was successful.

---

## Setup Instructions

### Prerequisites

- **milvus** : ensure you have milvus-gpu setup in a docker container
  
### Clone the Repository

```bash
git clone https://github.com/your-repo/hapservice.git
cd hapservice
```

### Generate gRPC Code

To generate client and server code for your specific language, use the `protoc` command as follows:

```bash
protoc --proto_path=. --<LANGUAGE>_out=. --grpc_out=. hapservice.proto
```

Replace `<LANGUAGE>` with the language of your choice, such as `python`, `go`, `java`, etc.

### Install Dependencies

Make sure you have all the necessary dependencies installed for your environment. For example, if you're using Python:

```bash
conda env update --file environment.yml --prune
```

### Run the Service

Start the server by running:

```bash
python main.py
```

## Contributing

We welcome contributions! Please follow the steps below to get started:

1. Fork the repository.
2. Create a new branch for your feature or bug fix.
3. Submit a pull request with a detailed description of your changes.

### Coding Standards

- Use consistent formatting and follow industry best practices.
- Ensure all code is well-documented.
- Write tests for new functionality.
